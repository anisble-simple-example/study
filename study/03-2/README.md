<pre>
★ [ playbook when ] setup 변수에서 값을 참조하여 when 조건 구현

[ansible@cent100 03-1]$ cat test03.yml 
---
- hosts: webs
  tasks:
    - command: hostname
      when: ansible_default_ipv4.address == "192.168.100.101"
[ansible@cent100 03-1]$ ansible-playbook test03.yml

PLAY [webs] ************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************
ok: [192.168.100.101]
ok: [192.168.100.102]

TASK [command] *********************************************************************************************************************
skipping: [192.168.100.102]
changed: [192.168.100.101]

PLAY RECAP *************************************************************************************************************************
192.168.100.101            : ok=2    changed=1    unreachable=0    failed=0   
192.168.100.102            : ok=1    changed=0    unreachable=0    failed=0   

★ [ playbook when ] setup 변수에서 값을 참조하여 when 리스트 조건 구현 ( AND 임 )
[ansible@cent100 03-1]$ cat test03.yml 
---
- hosts: webs
  tasks:
    - command: hostname
      when: 
        - ansible_default_ipv4.address == "192.168.100.101"
        - ansible_distribution =="CentOS"
[ansible@cent100 03-1]$ ansible-playbook test03.yml

PLAY [webs] ************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************
ok: [192.168.100.101]
ok: [192.168.100.102]

TASK [command] *********************************************************************************************************************
skipping: [192.168.100.102]
changed: [192.168.100.101]

PLAY RECAP *************************************************************************************************************************
192.168.100.101            : ok=2    changed=1    unreachable=0    failed=0   
192.168.100.102            : ok=1    changed=0    unreachable=0    failed=0   

★ [ playbook ignore_errors ] 에러가 발생하더라고 그냥 고고
★ [ playbook register, when ] register 이용하여 result 에 결과를 등록하고 when 조건에 failed, succeeded, skiped

[ansible@cent100 03-1]$ cat test04.yml
---
- hosts: web1
  tasks:
    - copy:
        src: no.txt
        dest: /tmp/no.txt
      register: result
      ignore_errors: true 
    - debug:
        msg: "copy fail"
      when: result is failed

    - ping:
      register: result1
    - debug:
        msg: "ping success"
      when: result1 is succeeded
[ansible@cent100 03-1]$ ansible-playbook test04.yml

PLAY [web1] ************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************
ok: [192.168.100.101]

TASK [copy] ************************************************************************************************************************
An exception occurred during task execution. To see the full traceback, use -vvv. The error was: If you are using a module and expect the file to exist on the remote, see the remote_src option
fatal: [192.168.100.101]: FAILED! => {"changed": false, "msg": "Could not find or access 'no.txt'\nSearched in:\n\t/home/ansible/03-1/files/no.txt\n\t/home/ansible/03-1/no.txt\n\t/home/ansible/03-1/files/no.txt\n\t/home/ansible/03-1/no.txt on the Ansible Controller.\nIf you are using a module and expect the file to exist on the remote, see the remote_src option"}
...ignoring

TASK [debug] ***********************************************************************************************************************
ok: [192.168.100.101] => {
    "msg": "copy fail"
}

TASK [ping] ************************************************************************************************************************
ok: [192.168.100.101]

TASK [debug] ***********************************************************************************************************************
ok: [192.168.100.101] => {
    "msg": "ping success"
}

PLAY RECAP *************************************************************************************************************************
192.168.100.101            : ok=5    changed=0    unreachable=0    failed=0   

★ [ playbook 변수를 이용한 debug ]
[ansible@cent100 03-1]$ cat test05.yml 
---
- hosts: web1
  vars:
    print1: false
  tasks:
    - command: "echo 'print1'"
      when: print1
    - command: "echo 'print2'"
[ansible@cent100 03-1]$ ansible-playbook test05.yml 

PLAY [web1] ************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************
ok: [192.168.100.101]

TASK [command] *********************************************************************************************************************
skipping: [192.168.100.101]

TASK [command] *********************************************************************************************************************
changed: [192.168.100.101]

PLAY RECAP *************************************************************************************************************************
192.168.100.101            : ok=2    changed=1    unreachable=0    failed=0  


★ [ playbook loop, when ]
[ansible@cent100 03-1]$ cat test06.yml
---
- hosts : web1, web2
  tasks:
    - debug:
        msg: "{{ item }}"
      with_items: 
        - AAA
        - BBB
        - CCC
      when: (item == "AAA") or (item == "BBB") 

[ansible@cent100 03-1]$ ansible-playbook test06.yml 

PLAY [web1, web2] ******************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************
ok: [192.168.100.101]
ok: [192.168.100.102]

TASK [debug] ***********************************************************************************************************************
ok: [192.168.100.101] => (item=AAA) => {
    "msg": "AAA"
}
ok: [192.168.100.101] => (item=BBB) => {
    "msg": "BBB"
}
skipping: [192.168.100.101] => (item=CCC) 
ok: [192.168.100.102] => (item=AAA) => {
    "msg": "AAA"
}
ok: [192.168.100.102] => (item=BBB) => {
    "msg": "BBB"
}
skipping: [192.168.100.102] => (item=CCC) 

PLAY RECAP *************************************************************************************************************************
192.168.100.101            : ok=2    changed=0    unreachable=0    failed=0   
192.168.100.102            : ok=2    changed=0    unreachable=0    failed=0   

★ [ playbook with_nested ] 이중 for문

[ansible@cent100 03-1]$ cat test07.yml
---
- hosts: web1
  tasks: 
    - debug:
        msg: "{{ item[0] }}{{ item[1] }}"
      with_nested:
        - [ 1, 2 ]
        - [ 10, 20, 30 ]
[ansible@cent100 03-1]$ ansible-playbook test07.yml

PLAY [web1] ************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************
ok: [192.168.100.101]

TASK [debug] ***********************************************************************************************************************
ok: [192.168.100.101] => (item=[1, 10]) => {
    "msg": "110"
}
ok: [192.168.100.101] => (item=[1, 20]) => {
    "msg": "120"
}
ok: [192.168.100.101] => (item=[1, 30]) => {
    "msg": "130"
}
ok: [192.168.100.101] => (item=[2, 10]) => {
    "msg": "210"
}
ok: [192.168.100.101] => (item=[2, 20]) => {
    "msg": "220"
}
ok: [192.168.100.101] => (item=[2, 30]) => {
    "msg": "230"
}

PLAY RECAP *************************************************************************************************************************
192.168.100.101            : ok=2    changed=0    unreachable=0    failed=0   

★ [ playbook with_file ] 반복문을 이용한 파일 내용 보기

[ansible@cent100 03-1]$ cat test1.txt 
test11
test12
[ansible@cent100 03-1]$ cat test2.txt 
test21
test22
[ansible@cent100 03-1]$ ansible-playbook test08.yml 

PLAY [web1] ************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************
ok: [192.168.100.101]

TASK [debug] ***********************************************************************************************************************
ok: [192.168.100.101] => (item=test11
test12) => {
    "msg": "test11\ntest12"
}
ok: [192.168.100.101] => (item=test21
test22) => {
    "msg": "test21\ntest22"
}

PLAY RECAP *************************************************************************************************************************
192.168.100.101            : ok=2    changed=0    unreachable=0    failed=0   

★ [ block ] block, rescue, always 으로 구분하고 관리함 

[ansible@cent100 03-1]$ cat test09.yml
- hosts: web1
  tasks:
    - name: block teste
      block:
        - debug: msg='step1'
        - command: /bin/false
        - debug: msg='step2'
      rescue:
        - debug: msg='step3'
        - command: /bin/false
        - debug: msg='step4'
      always:
        - debug: msg='step5'
[ansible@cent100 03-1]$ ansible-playbook test09.yml 

PLAY [web1] ************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************
ok: [192.168.100.101]

TASK [debug] ***********************************************************************************************************************
ok: [192.168.100.101] => {
    "msg": "step1"
}

TASK [command] *********************************************************************************************************************
fatal: [192.168.100.101]: FAILED! => {"changed": true, "cmd": ["/bin/false"], "delta": "0:00:00.001829", "end": "2019-03-22 00:07:24.073375", "msg": "non-zero return code", "rc": 1, "start": "2019-03-22 00:07:24.071546", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [debug] ***********************************************************************************************************************
ok: [192.168.100.101] => {
    "msg": "step3"
}

TASK [command] *********************************************************************************************************************
fatal: [192.168.100.101]: FAILED! => {"changed": true, "cmd": ["/bin/false"], "delta": "0:00:00.001827", "end": "2019-03-22 00:07:24.405744", "msg": "non-zero return code", "rc": 1, "start": "2019-03-22 00:07:24.403917", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [debug] ***********************************************************************************************************************
ok: [192.168.100.101] => {
    "msg": "step5"
}
        to retry, use: --limit @/home/ansible/03-1/test09.retry

PLAY RECAP *************************************************************************************************************************
192.168.100.101            : ok=4    changed=0    unreachable=0    failed=2   

[ansible@cent100 03-1]$ 


</pre>